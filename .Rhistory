library(data.table)
library(dplyr)
parms.src <- "P:/Jing 2/2007-07/Taper Data/2012 update/R results"
parms.Hobs <- haven::read_sas(file.path(parms.src, "Resultr_obsh_1.sas7bdat"))
parms.Hobs[is.na(parms.Hobs)] <- 0
setDT(parms.Hobs)
parms.Hobs <- parms.Hobs[, c( "Hchoice", "CANFI_code", "fixed_b", names(parms.Hobs)[startsWith(names(parms.Hobs), "stddev")]), with = FALSE]
View(parms.Hobs)
parms.Hobs <- haven::read_sas(file.path(parms.src, "Resultr_obsh_1.sas7bdat"))
parms.Hobs[is.na(parms.Hobs)] <- 0
setDT(parms.Hobs)
library("devtools")
use_data(parms.Hobs)
devtools::load_all(".")
use_description(fields = list(import = c("data.table")))
use_description(fields = list(import = c("data.table", "dplyr")))
use_description(fields = list(import = c("data.table")))
use_description(fields = list(import = c("dplyr")))
use_description(fields = list(import = c("dplyr", "data.table")))
use_package("VolumeTaper")
use_package(c("data.table", "dplyr"))
use_package(c("data.table"))
use_package(c("dplyr"))
parms.src <- "P:/Jing 2/2007-07/Taper Data/2012 update/R results"
parms.Hest <- haven::read_sas(file.path(parms.src, "Resultr_esth_1.sas7bdat"))
parms.Hest <- haven::read_sas(file.path(parms.src, "Resultr_esth_1.sas7bdat"))
parms.Hest
parms.obsH
parms.obsH <- haven::read_sas(file.path(parms.src, "Resultr_obsh_1.sas7bdat"))
parms.obsH
library(devtools)
use_data("parms.obsH")
use_data(parms.obsH)
use_data(parms.EstH)
parms.EstH <- haven::read_sas(file.path(parms.src, "Resultr_esth_1.sas7bdat"))
parms.EstH[is.na(parms.EstH)] <- 0
setDT(parms.EstH)
parms.EstH <- parms.EstH[, c( "Hchoice", "CANFI_code","a1", "a2", "b", names(parms.EstH)[startsWith(names(parms.EstH), "stddev")]), with = FALSE]
parms.EstH[,var_b := stddev_prov_b^2 + stddev_idPlot_b^2 + stddev_idtree_b^2 ]
parms.EstH[,var_a2 := stddev_prov_a2^2 + stddev_idPlot_a2^2 ]
parms.EstH <- parms.EstH[, -names(parms.EstH)[startsWith(names(parms.EstH), "stddev")], with = FALSE]
View(parms.EstH)
parms.EstH <- haven::read_sas(file.path(parms.src, "Resultr_esth_1.sas7bdat"))
parms.EstH[is.na(parms.EstH)] <- 0
setDT(parms.EstH)
View(parms.EstH)
spc.name <- readxl::read_xls("P:/Jing 2/2007-07/Taper Data/J data/Presentation/species name.xls")
setDT(spc.name)
parms.ObsH <- parms.ObsH[spc.name, on = c(CANFI_code = "canfi_code3"), nomatch = 0]
parms.ObsH <- haven::read_sas(file.path(parms.src, "Resultr_ObsH_1.sas7bdat"))
parms.ObsH[is.na(parms.ObsH)] <- 0
setDT(parms.ObsH)
spc.name <- readxl::read_xls("P:/Jing 2/2007-07/Taper Data/J data/Presentation/species name.xls")
setDT(spc.name)
parms.ObsH <- parms.ObsH[spc.name, on = c(CANFI_code = "canfi_code3"), nomatch = 0]
setcolorder(parms.ObsH, c("Hchoice", "name_eng"))
View(parms.ObsH)
library(data.table)
library(dplyr)
parms.src <- "P:/Jing 2/2007-07/Taper Data/2012 update/R results"
tab4.ObsH <- haven::read_sas(file.path(parms.src, "Resultr_ObsH_1.sas7bdat"))
tab4.ObsH[is.na(tab4.ObsH)] <- 0
setDT(tab4.ObsH)
tab4.ObsH <- tab4.ObsH[, c( "Hchoice", "CANFI_code", "fixed_b", names(tab4.ObsH)[startsWith(names(tab4.ObsH), "stddev")]), with = FALSE]
View(tab4.ObsH)
tab4.ObsH <- haven::read_sas(file.path(parms.src, "Resultr_ObsH_1.sas7bdat"))
tab4.ObsH[is.na(tab4.ObsH)] <- 0
setDT(tab4.ObsH)
tab4.ObsH <- tab4.ObsH[, c( "Hchoice", "CANFI_code", "fixed_b", names(tab4.ObsH)[startsWith(names(tab4.ObsH), "stddev")]), with = FALSE]
spc.name <- readxl::read_xls("P:/Jing 2/2007-07/Taper Data/J data/Presentation/species name.xls")
setDT(spc.name)
tab4.ObsH <- tab4.ObsH[spc.name, on = c(CANFI_code = "canfi_code3"), nomatch = 0]
setcolorder(tab4.ObsH, c("Hchoice", "name_eng"))
View(tab4.ObsH)
tab6.EstH <- haven::read_sas(file.path(parms.src, "Resultr_esth_1.sas7bdat"))
tab6.EstH[is.na(tab6.EstH)] <- 0
setDT(tab6.EstH)
tab6.EstH <- tab6.EstH[, c( "Hchoice", "CANFI_code","a1", "a2", "b", names(tab6.EstH)[startsWith(names(tab6.EstH), "stddev")]), with = FALSE]
tab6.EstH <- tab6.EstH[spc.name, on = c(CANFI_code = "canfi_code3"), nomatch = 0]
setcolorder(tab6.EstH, c("Hchoice", "name_eng"))
View(tab6.EstH)
setcolorder(tab6.EstH, c("Hchoice", "name_eng", names(tab6.EstH)[endsWith(names(tab6.EstH), "_a2")]))
names(tab6.EstH)
setcolorder(tab6.EstH, c("Hchoice", "name_eng", "CANFI_code", "stddev_prov_a2","stddev_idPlot_a2", "stddev_prov_b"))
names(tab6.EstH)
setcolorder(tab6.EstH, c("Hchoice", "name_eng", "CANFI_code", "a1", "a2", "b", "stddev_prov_a2","stddev_idPlot_a2", "stddev_prov_b"))
names(tab6.EstH)
names(tab4.ObsH)
use_data(tab4.ObsH)
use_data(tab6.EstH)
use_r("parms.ObsH")
use_r("parms_ObsH")
names(tab4.ObsH)
use_r("parms_EstH")
names(tab6.EstH)
?VolumeTaper
??VolumeTaper
View(tab4.ObsH)
rm(tab4.ObsH)
data(tab4.ObsH)
?unnest_longer
??unnest_longer
install.packages("tidyr")
use_package("tidyr")
?data()
devtools::load_all(".")
install.packages("devtools")
install.packages("Rtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("tidyr")
install.packages("data.table")
install.packages("dplyr")
library(VolumeTaper)
?volTaper
data("tab4.ObsH")
sample_data <- data.table::data.table(
canfi = c(101),
treeID = c(1),
dbh_cm = c(30),
Htot_m = c(18)
)
V_ObsH.R <- volTaper(data = sample_data, measuredH = TRUE, limit.dob = 9, limit.height = NULL)
View(V_ObsH.R)
library(VolumeTaper)
library(VolumeTaper)
?volTaper
sample_data <- data.table::data.table(
canfi = c(101,102),
treeID = c(1,2),
dbh_cm = c(30,30),
Htot_m = c(18,18)
)
V_ObsH.R <- volTaper(data = sample_data, measuredH = TRUE, limit.dob = 9, limit.height = NULL)
V_ObsH.R
V_EstH.R <- volTaper(data = sample_data, measuredH = FALSE, limit.dob = 9, limit.height = NULL)
V_EstH.R
data <- sample_data
# data(tab6.EstH)
var_b <- var_a2 <- Htot_m <- c <- Dob2P0 <- Der2_b <- Der2_a2 <- dob2P <- NULL
stddev_prov_b <- stddev_idPlot_b <- stddev_idtree_b <- stddev_prov_a2 <- stddev_idPlot_a2 <- a1 <- a2 <- b <- NULL
tab6.EstH <- data.table::data.table(tab6.EstH)
tab6.EstH[,var_b := stddev_prov_b^2 + stddev_idPlot_b^2 + stddev_idtree_b^2 ]
tab6.EstH[,var_a2 := stddev_prov_a2^2 + stddev_idPlot_a2^2 ]
df <- data[tab6.EstH [, c("CANFI_code", "a1", "a2", "b" , "var_a2", "var_b")], on = c(canfi = "CANFI_code"), nomatch = 0]
df[, Htot_m := round(a1*dbh_cm^a2, 1)]
df2 <- df %>%
rowwise() %>%
transmute(canfi,treeID, dbh_cm, Htot_m, a1,a2,b,var_a2,var_b, h = list(seq_a(0.1, Htot_m, 0.1))) %>%
unnest_longer(h)
library(dplyr)
df2 <- df %>%
rowwise() %>%
transmute(canfi,treeID, dbh_cm, Htot_m, a1,a2,b,var_a2,var_b, h = list(seq_a(0.1, Htot_m, 0.1))) %>%
unnest_longer(h)
library(tidyr)
df2 <- df %>%
rowwise() %>%
transmute(canfi,treeID, dbh_cm, Htot_m, a1,a2,b,var_a2,var_b, h = list(seq_a(0.1, Htot_m, 0.1))) %>%
unnest_longer(h)
seq_a <- function(ifirst, ilast, iby){
if (ilast*10 > floor(ilast*10))
return(c(seq(ifirst, ilast, iby), ilast)) else
return(seq(ifirst, ilast, iby))
}
# expand the data
df <- data %>%
rowwise() %>%
transmute(canfi,treeID, dbh_cm, Htot_m, h = list(seq_a(0.1, Htot_m, 0.1))) %>%
unnest_longer(h)
df2 <- df %>%
rowwise() %>%
transmute(canfi,treeID, dbh_cm, Htot_m, a1,a2,b,var_a2,var_b, h = list(seq_a(0.1, Htot_m, 0.1))) %>%
unnest_longer(h)
setDT(df2) [, c:= (Htot_m - h)/(Htot_m - 1.3)]
df2[  , Dob2P0 := dbh_cm^2* c * (h/1.3)^(2-b) ]
library(data.table)
setDT(df2) [, c:= (Htot_m - h)/(Htot_m - 1.3)]
df2[  , Dob2P0 := dbh_cm^2* c * (h/1.3)^(2-b) ]
df2[,Der2_b := dob2P0*(log(h/1.3))^2]
df2[,Der2_b := Dob2P0*(log(h/1.3))^2]
df2[,Der2_a2 := -1*dbh_cm^2*(h/1.3)^(2-b)*(log(dbh_cm))^2*(h-1.3)*a1*dbh_cm^a2*( a1*dbh_cm^a2+1.3)/( a1*dbh_cm^a2 - 1.3)^3]
df2[,dob2P := Dob2P0+0.5*var_b*Der2_b + 0.5*var_a2*Der2_a2]
df2 <- df2[dob2P >= 0]
df2 <- df2[, c("canfi", "treeID", "h", "dob2P")]
# volume
setorder(df2, canfi, treeID, h)
df2[, dob2P_pre:= shift(dob2P), by = .(canfi, treeID)]
# h criteria
if(!(is.null(limit.height))) df2 <- df2[h <= limit.height]
library(VolumeTaper)
library(VolumeTaper)
library(VolumeTaper)
V_EstH.R <- volTaper(data = sample_data, measuredH = FALSE, limit.dob = 9, limit.height = NULL)
sample_data <- data.table::data.table(
canfi = c(101,102),
treeID = c(1,2),
dbh_cm = c(30,30),
Htot_m = c(18,18)
)
V_EstH.R <- volTaper(data = sample_data, measuredH = FALSE, limit.dob = 9, limit.height = NULL)
V_ObsH.R <- volTaper(data = sample_data, measuredH = TRUE, limit.dob = 9, limit.height = NULL)
usethis::git_sitrep()
## store your personal access token with: GITHUB_PAT=xxxyyyzzz
## and make sure '.Renviron' ends with a newline
gitcreds::gitcreds_set("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")
?gitcreds_set
## store your personal access token with: GITHUB_PAT=xxxyyyzzz
## and make sure '.Renviron' ends with a newline
gitcreds::gitcreds_set(url = "https://github.com")
## store your personal access token with: GITHUB_PAT=xxxyyyzzz
## and make sure '.Renviron' ends with a newline
gitcreds::gitcreds_set(url = "https://github.com")
gitcreds_get("https://myuser@github.com/xjguo-ca/volumecalculator")
gitcreds::gitcreds_get("https://myuser@github.com/xjguo-ca/volumecalculator")
git_default_branch_rediscover()
??git_default_branch_rediscover()
usethis::git_default_branch_rename(from = "master", to = "main")
usethis::git_sitrep()
## store your personal access token with: GITHUB_PAT=xxxyyyzzz
## and make sure '.Renviron' ends with a newline
gitcreds::gitcreds_set(url = "https://github.com/xjguo-ca/volume-calculator")
??gitcreds_set
gitcreds_get(use_cache = FALSE)$password
gitcreds::gitcreds_get(use_cache = FALSE)$password
gitcreds::gitcreds_get(use_cache = FALSE)$username
gitcreds::gitcreds_get(use_cache = FALSE)
## or store it manually in '.Renviron':
usethis::edit_r_environ()
## set your user name and email:
usethis::use_git_config(user.name = "xjguo-ca", user.email = "xiaojing.guo.ca@gmail.com")
## in case usethis version < 2.0.0: usethis::browse_github_token() (or even better: update usethis!)
# token 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
## set personal access token:
credentials::set_github_pat("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")
## in case usethis version < 2.0.0: usethis::browse_github_token() (or even better: update usethis!)
# token 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
## set personal access token:
credentials::set_github_pat("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")
